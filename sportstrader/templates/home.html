{% extends 'base.html' %}

{% block content %}

<div class="container-fluid px-lg-5 px-md-3 px-sm-2 mt-3 main-container ">

  <div class="form-check form-check-inline  mb-2">
    <!-- <input type="text" class="form-control" id="datepicker" placeholder="Date "> -->
    <input type="text" class="form-control" id="datepicker" placeholder="Date"> 
  </div>

  <div class="form-check form-check-inline">
    <select class="form-control" id="quantityFilter">
      <option value="5">5</option>
      <option value="10">10</option>
      <option value="25">25</option>
      <option value="50">50</option>
      <option value="custom" >Custom</option>
      <option value="all">All rows</option>
    </select>
  </div>
  
  <div class="form-check form-check-inline custom  mb-2">
  </div>

  <div class="form-check form-check-inline">
    <select id="win_filter" class="form-control" >
      <option value="all_result"> All Result </option>
      <option value="HOME_TEAM_WIN">Filter by home team win</option>
      <option value="DRAW">Filter by draw</option>
      <option value="AWAY_TEAM_WIN">Filter by away team win</option>
    </select>
  </div>



  <div class="message"></div>
<hr>

<table class=" table  table-light table-striped table-borderless table-responsive-sm mt-4 table-bordered box-shadow">
<thead>
  <tr class="box-shadow">

    <th scope="col" class="text-dark">Venue</th>
    <th scope="col" class="text-dark">Competition Name</th>

    <th scope="col" class="text-dark">Start State</th>
    <th scope="col" class="text-dark">Home Team</th>
    <th scope="col" class="text-dark">Home Country</th>
    <th scope="col" class="text-dark"></th>

    <th scope="col" class="text-dark">Away Team</th>
    <th scope="col" class="text-dark">Away Country</th>
    <th scope="col" class="text-dark">Result</th>

  </tr>
</thead>
<tbody class="all_table">

  <h4 class="title"> All Results </h4>

  {% for event in events %}

  <tr class="table-hover box-shadow"> 
   
    <td class="text-dark ">{{ event.venue }}</td>
    <td class="text-dark">{{event.competition_name}}</td>
    <td class="text-dark">{{ event.start_date }}</td>
    <td class="text-dark">{{ event.home_name }}</td>
    <td class="text-dark">{{ event.home_country }}</td>
    <td class="text-dark">  VS </td>

    <td class="text-dark">{{ event.away_name }}</td>
    <td class="text-dark">{{ event.away_country }}</td>
    <td class="text-dark result_type">( {{event.result_type}} : {{ event.result }}% )</td>

  </tr>
  {% endfor %}

</tbody>
</table>


</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.js" integrity="sha512-CX7sDOp7UTAq+i1FYIlf9Uo27x4os+kGeoT7rgwvY+4dmjqV0IuE/Bl5hVsjnQPQiTOhAX1O2r2j5bjsFBvv/A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>

filter_dict = {

}

filter_dict['filter_qty'] = $('#quantityFilter').val()

filter_dict['result_filter'] = $('#win_filter').val()

$('#win_filter').on('change', function () {
  var value = $(this).val();

  filter_dict['result_filter'] = value

  $.ajax({
      type: "GET",
      url: 'fetch_data/',
      data: {
        filter_dict : JSON.stringify(filter_dict)
      },
      contentType: "application/json; charset=utf-8",
      success: function (data) {
          html = ''
          $.each(data.data, function(index, event) {
          html += 
            `
            <tr class="table-hover box-shadow"> 
              <td class="text-dark">${ event.venue }</td>
              <td class="text-dark">${event.competition_name}</td>
              <td class="text-dark">${event.start_date}</td>
              <td class="text-dark">${ event.home_name }</td>
              <td class="text-dark">${ event.home_country }</td>
              <td class="text-dark">  VS </td>

              <td class="text-dark">${ event.away_name }</td>
              <td class="text-dark">${ event.away_country }</td>
              <td class="text-dark result_type">(${event.result_type} : ${ event.result } % )</td>
            </tr>
            `
          });

           if (html.length === 0 ){
            $('.message').html(`<div class=" mt-3 alert alert-warning">You don't have any Data for the selected Team</div>`)
            $('.all_result_table').hide()
            $('.all_table').html(' ')
            $('.title').text('Filter result based upon   '+ value)
           } else {
            $('.message').html('')
            $('.all_table').html(html)
            $('.all_result_table').hide()
            $('.title').text('Filter result based upon   '+ value)
          }
      },
      error: function (xhr, status, error) {
          console.log(xhr.responseText);
      }
  });
});


$('#quantityFilter').on('change', function () {

filter_dict['filter_qty'] = $(this).val();

$.ajax({
  
    type: "GET",
    url: 'fetch_qty/',
    contentType: "application/json; charset=utf-8",
    data: {
      
      filter_dict : JSON.stringify(filter_dict)
    
    },

    success: function (data) {
     
      html = ''
   
          $.each(data.data, function(index, event) {

          html += 

            `
            <tr class="table-hover box-shadow"> 
              <td class="text-dark">${ event.venue }</td>
              <td class="text-dark">${event.competition_name}</td>
              <td class="text-dark">${event.start_date}</td>
              <td class="text-dark">${ event.home_name }</td>
              <td class="text-dark">${ event.home_country }</td>
              <td class="text-dark">  VS </td>
              <td class="text-dark">${ event.away_name }</td>
              <td class="text-dark">${ event.away_country }</td>
              <td class="text-dark result_type">(${event.result_type} : ${ event.result } % )</td>
            </tr>
            `
          });
        
           if (html.length === 0 ){
            $('.message').html(`<div class=" mt-3 alert alert-warning">You don't have any Data for the selected Team</div>`)
            $('.all_result_table').hide()
            $('.all_table').html(' ')
            $('.title').text('Filter result based upon   ')
           } else {
            $('.message').html('')
            $('.all_table').html(html)
            $('.all_result_table').hide()
            $('.title').text('Filter result based upon   ')
          }
    },
    error: function (xhr, status, error) {
        console.log(xhr.responseText);
    }
});


});



$('#datepicker').on('change', function () {

var value_date= $(this).val();

if (value_date === ""){
  alert('I am null')
} else {
  alert( " i am not null")
}
filter_dict['filter_date'] = value_date

$.ajax({
  
    type: "GET",
    url: 'fetch_date/',
    contentType: "application/json; charset=utf-8",
    data: {
      
      filter_dict : JSON.stringify(filter_dict)

    },

    success: function (data) {

      html = ''
          
          $.each(data.data, function(index, event) {
      
          html += 
            `
            <tr class="table-hover box-shadow"> 
              <td class="text-dark">${ event.venue }</td>
              <td class="text-dark">${event.competition_name}</td>
              <td class="text-dark">${event.start_date}</td>
              <td class="text-dark">${ event.home_name }</td>
              <td class="text-dark">${ event.home_country }</td>
              <td class="text-dark">  VS </td>

              <td class="text-dark">${ event.away_name }</td>
              <td class="text-dark">${ event.away_country }</td>
              <td class="text-dark result_type">(${event.result_type} : ${ event.result } % )</td>
            </tr>
            `
          });

           if (html.length === 0 ){

            $('.message').html(`<div class=" mt-3 alert alert-warning">You don't have any Data for the selected Team</div>`)
            $('.all_result_table').hide()
            $('.all_table').html(' ')
            $('.title').text('Filter result based upon   '+ value)
            
           } else {
            $('.message').html('')
            $('.all_table').html(html)
            $('.all_result_table').hide()
            $('.title').text('Filter result based upon   '+ value)

          }
        
    },
    error: function (xhr, status, error) {
        console.log(xhr.responseText);
    }
});
});


</script>

{% endblock %}